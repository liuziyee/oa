<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dorohedoro.mapper.MeetingMapper">

    <select id="selectPage" resultType="meeting">
        select m.id, m.uuid, m.title, m.place, m.type, m.status, m.desc, u2.name as creator, u2.avatar_url,
               date_format(m.date, '%Y年%m月%d日') as date,
               date_format(m.start, '%H:%i') as start,
               date_format(m.end, '%H:%i') as end,
               timestampdiff(hour, concat(m.date + ' ' + m.start), concat(m.date + ' ' + m.end)) as hour
        from meeting m
        join user u1 on json_contains(m.members, cast(u1.id as char))
        join user u2 on m.creator_id = u2.id
        where u1.id = #{userId} and u1.status = 1 and u2.status = 1 and m.status in (3,4)
        order by m.date, m.start, m.id
    </select>
</mapper>
